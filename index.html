<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marcador PÃ del - PWA</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0066ff">
<link rel="icon" href="icon-192.png">
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 0; }
  h1 { margin: 10px; }
  .container { display: flex; justify-content: space-around; align-items: flex-start; padding: 20px; gap: 20px; flex-wrap: wrap; }
  .team { flex: 1 1 300px; padding: 20px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
  .blue-team { background: #0066ff22; }
  .red-team  { background: #ff000022; }
  .players { font-size: 1.5em; margin-bottom: 15px; }
  input { font-size: 1em; text-align: center; border: none; background: transparent; border-bottom: 1px solid #ccc; margin: 5px 0; width: 80%; }
  .score { font-size: 10vw; font-weight: bold; margin: 20px 0; }
  .games, .sets { font-size: 2em; margin: 10px 0; }
  .controls button { padding: 12px 20px; margin: 5px; font-size: 1em; border-radius: 12px; border: none; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
  .blue-btn { background: #0066ff; color: #fff; }
  .red-btn { background: #ff0000; color: #fff; }
  .listen-indicator { width: 20px; height: 20px; border-radius: 50%; background: green; margin: 10px auto; display: none; }
</style>
</head>
<body>
<h1>Marcador PÃ del</h1>
<div class="listen-indicator" id="listenIndicator"></div>

<div class="container">
  <div class="team blue-team">
    <div class="players">
      <input id="bluePlayer1" value="Jugador 1">
      <input id="bluePlayer2" value="Jugador 2">
    </div>
    <div id="blueScore" class="score" style="color:#0066ff">0</div>
    <div id="blueGames" class="games">0</div>
    <div id="blueSets" class="sets">0</div>
    <div class="controls">
      <button class="blue-btn" onclick="addPoint('blue')">+ Azul</button>
    </div>
  </div>

  <div class="team red-team">
    <div class="players">
      <input id="redPlayer1" value="Jugador 3">
      <input id="redPlayer2" value="Jugador 4">
    </div>
    <div id="redScore" class="score" style="color:#ff0000">0</div>
    <div id="redGames" class="games">0</div>
    <div id="redSets" class="sets">0</div>
    <div class="controls">
      <button class="red-btn" onclick="addPoint('red')">+ Rojo</button>
    </div>
  </div>
</div>

<div class="controls">
  <button onclick="undoLast()">â†© Deshacer</button>
  <button onclick="resetMatch()">âŸ³ Reiniciar</button>
  <button onclick="toggleMic()">ðŸŽ¤ MicrÃ³fono</button>
</div>

<script>
let scores={blue:0,red:0}, games={blue:0,red:0}, sets={blue:0,red:0}, history=[];
let listening=false;

function updateDisplay(){
  document.getElementById("blueScore").innerText=scores.blue;
  document.getElementById("redScore").innerText=scores.red;
  document.getElementById("blueGames").innerText=games.blue;
  document.getElementById("redGames").innerText=games.red;
  document.getElementById("blueSets").innerText=sets.blue;
  document.getElementById("redSets").innerText=sets.red;
}

function addPoint(team){
  history.push({scores:{...scores},games:{...games},sets:{...sets}});
  scores[team]++;
  updateDisplay();
}

function undoLast(){
  if(history.length>0){
    let prev=history.pop();
    scores=prev.scores; games=prev.games; sets=prev.sets;
    updateDisplay();
  }
}

function resetMatch(){
  if(!confirm("Â¿Reiniciar partido?")) return;
  scores={blue:0,red:0}; games={blue:0,red:0}; sets={blue:0,red:0}; history=[];
  updateDisplay();
}

// ---- Reconocimiento de voz ----
const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;
let recognition=null;

if(SpeechRecognition){
  recognition=new SpeechRecognition();
  recognition.lang="es-ES";
  recognition.continuous=false; 
  recognition.interimResults=false;

  recognition.onresult=(event)=>{
    const transcript=event.results[0][0].transcript.toLowerCase();
    console.log("Reconocido:",transcript);
    if(transcript.includes("azul")) addPoint("blue");
    if(transcript.includes("rojo")) addPoint("red");
    if(transcript.includes("cancelar")) undoLast();
  };

  recognition.onerror=(e)=>console.error("SpeechRecognition error:",e.error);

  recognition.onend=()=>{ if(listening) recognition.start(); };
}

function toggleMic(){
  if(!recognition){ alert("Reconocimiento no disponible."); return; }
  if(listening){
    recognition.stop(); listening=false;
    document.getElementById("listenIndicator").style.display="none";
  }else{
    recognition.start(); listening=true;
    document.getElementById("listenIndicator").style.display="block";
  }
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(() => console.log("Service Worker registrat!"));
}

updateDisplay();
</script>
</body>
</html>